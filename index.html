<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loter√≠a DRG - Comprobador Local</title>
    
    <!-- Estilos Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para traducir el c√≥digo en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: system-ui, -apple-system, sans-serif; }
        /* Animaciones simples */
        @keyframes bounce { 0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8,0,1,1); } 50% { transform: translateY(0); animation-timing-function: cubic-bezier(0,0,0.2,1); } }
        .animate-bounce { animation: bounce 1s infinite; }
    </style>
</head>
<body class="bg-emerald-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONOS SVG (Inline para evitar dependencias externas) ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} dangerouslySetInnerHTML={{ __html: path }} />
        );

        const Icons = {
            Plus: (props) => <Icon path='<path d="M5 12h14"/><path d="M12 5v14"/>' {...props} />,
            Trash2: (props) => <Icon path='<path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/>' {...props} />,
            Ticket: (props) => <Icon path='<path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/>' {...props} />,
            CheckCircle2: (props) => <Icon path='<circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/>' {...props} />,
            Gift: (props) => <Icon path='<rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5C10 3 12 6 12 6s2-3 4.5-3a2.5 2.5 0 0 1 0 5"/>' {...props} />,
            RefreshCw: (props) => <Icon path='<path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/>' {...props} />,
            X: (props) => <Icon path='<path d="M18 6 6 18"/><path d="m6 6 12 12"/>' {...props} />,
            Coins: (props) => <Icon path='<circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m7.1 13.84 1.59-1.59"/>' {...props} />,
            Sparkles: (props) => <Icon path='<path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275Z"/>' {...props} />,
            Save: (props) => <Icon path='<path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>' {...props} />,
            Download: (props) => <Icon path='<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>' {...props} />,
            Upload: (props) => <Icon path='<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/>' {...props} />
        };

        const App = () => {
          // --- ESTADOS ---
          const [tickets, setTickets] = useState(() => {
            const saved = localStorage.getItem('loteria_tickets_local');
            return saved ? JSON.parse(saved) : [];
          });

          const [newTicketNumber, setNewTicketNumber] = useState('');
          const [newTicketAmount, setNewTicketAmount] = useState('');
          const [newTicketNote, setNewTicketNote] = useState('');

          const [checkNumber, setCheckNumber] = useState('');
          const [prizeType, setPrizeType] = useState('gordo');
          
          const [lastResult, setLastResult] = useState(null);
          const [isModalOpen, setIsModalOpen] = useState(false);

          // --- PREMIOS ---
          const PRIZE_VALUES = {
            'gordo': { name: 'El Gordo (1¬∫ Premio)', multiplier: 20000 },
            'segundo': { name: 'Segundo Premio', multiplier: 6250 },
            'tercero': { name: 'Tercer Premio', multiplier: 2500 },
            'cuarto': { name: 'Cuarto Premio', multiplier: 1000 },
            'quinto': { name: 'Quinto Premio', multiplier: 300 },
            'pedrea': { name: 'Pedrea / Menor', multiplier: 5 }
          };

          useEffect(() => {
            localStorage.setItem('loteria_tickets_local', JSON.stringify(tickets));
          }, [tickets]);

          // --- FUNCIONES ---
          const addTicket = (e) => {
            e.preventDefault();
            if (newTicketNumber.length < 5) {
                alert("El n√∫mero debe tener 5 cifras (ej: 00123).");
                return;
            }
            const newTicket = {
              id: Date.now(),
              number: newTicketNumber,
              amount: newTicketAmount || 20,
              note: newTicketNote
            };
            setTickets([...tickets, newTicket]);
            setNewTicketNumber('');
            setNewTicketAmount('');
            setNewTicketNote('');
          };

          const removeTicket = (id) => {
            if (!confirm("¬øBorrar este d√©cimo?")) return;
            setTickets(tickets.filter(t => t.id !== id));
          };

          const handleNumberInput = (value, setter) => {
            const numericValue = value.replace(/[^0-9]/g, '').slice(0, 5);
            setter(numericValue);
          };

          const formatMoney = (amount) => {
            return new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' }).format(amount);
          };

          // --- EXPORTAR E IMPORTAR ---
          const handleExport = () => {
              if (tickets.length === 0) {
                  alert("No hay datos para exportar.");
                  return;
              }
              const dataStr = JSON.stringify(tickets);
              // Codificar simple a base64 para facilitar el copiar/pegar sin romper caracteres
              const encoded = btoa(unescape(encodeURIComponent(dataStr))); 
              prompt("Copia este C√ìDIGO y p√©galo en 'Importar' en tu otro dispositivo:", encoded);
          };

          const handleImport = () => {
              const code = prompt("Pega aqu√≠ el c√≥digo que copiaste del otro dispositivo:");
              if (!code) return;
              try {
                  const decoded = decodeURIComponent(escape(atob(code)));
                  const json = JSON.parse(decoded);
                  if (Array.isArray(json)) {
                      if(confirm(`Se van a cargar ${json.length} d√©cimos. Esto reemplazar√° lo que tienes ahora. ¬øContinuar?`)) {
                        setTickets(json);
                        alert("¬°Datos cargados correctamente!");
                      }
                  } else {
                      alert("El c√≥digo no parece v√°lido.");
                  }
              } catch (e) {
                  alert("Error al leer el c√≥digo. Aseg√∫rate de copiarlo entero.");
              }
          };

          const calculateResults = (winningNumber, typeOfPrize) => {
            const selectedPrize = PRIZE_VALUES[typeOfPrize];
            const multiplier = selectedPrize.multiplier;

            const exactMatches = tickets
              .filter(t => t.number === winningNumber)
              .map(t => ({ ...t, prizeAmount: t.amount * multiplier }));

            const endingMatches = tickets.filter(t => 
              t.number !== winningNumber && 
              t.number.slice(-2) === winningNumber.slice(-2)
            );

            const totalWon = exactMatches.reduce((acc, curr) => acc + curr.prizeAmount, 0);

            setLastResult({
              checkedNumber: winningNumber,
              prizeName: selectedPrize.name,
              prizeMultiplier: multiplier,
              exact: exactMatches,
              terminations: endingMatches,
              totalWon: totalWon,
              hasPrize: exactMatches.length > 0 || endingMatches.length > 0
            });
            setIsModalOpen(true);
          };

          const checkWinningNumber = (e) => {
            e.preventDefault();
            if (checkNumber.length < 5) return;
            calculateResults(checkNumber, prizeType);
          };

          const simulateDraw = () => {
            if (tickets.length === 0) {
                alert("A√±ade alg√∫n d√©cimo primero para poder jugar al simulacro.");
                return;
            }
            const randomTicket = tickets[Math.floor(Math.random() * tickets.length)];
            setCheckNumber(randomTicket.number);
            setPrizeType('gordo');
            calculateResults(randomTicket.number, 'gordo');
          };

          const totalInvested = tickets.reduce((acc, curr) => acc + Number(curr.amount), 0);

          // --- UI ---
          return (
            <div className="min-h-screen text-slate-800 font-sans pb-12">
              {/* Header */}
              <header className="bg-emerald-800 text-white p-6 shadow-lg border-b-4 border-yellow-500 relative overflow-hidden">
                <div className="absolute top-0 right-0 p-4 opacity-10">
                    <Icons.Save size={100} />
                </div>
                <div className="max-w-3xl mx-auto flex items-center justify-between relative z-10">
                  <div>
                    <h1 className="text-2xl md:text-3xl font-serif font-bold tracking-wider text-yellow-100 drop-shadow-md">
                      Mi Loter√≠a
                    </h1>
                    <p className="text-emerald-200 text-sm mt-1 flex items-center gap-2">
                        <span className="bg-emerald-900/50 px-2 py-0.5 rounded text-xs uppercase tracking-widest border border-emerald-600">Archivo Local</span>
                        HTML
                    </p>
                  </div>
                  <div className="hidden md:block text-right">
                    <p className="text-yellow-400 font-bold text-xl">{tickets.length} D√©cimos</p>
                    <p className="text-xs opacity-80">{totalInvested}‚Ç¨ jugados</p>
                  </div>
                </div>
              </header>

              <main className="max-w-3xl mx-auto p-4 space-y-8">
                
                {/* 1. A√±adir */}
                <section className="bg-white rounded-xl shadow-md overflow-hidden border border-emerald-100">
                  <div className="bg-slate-700 p-3 flex items-center gap-2 text-white">
                    <Icons.Ticket className="text-emerald-300" size={20} />
                    <h2 className="font-bold text-sm uppercase">Mis N√∫meros</h2>
                  </div>
                  <div className="p-5">
                    <form onSubmit={addTicket} className="flex flex-col md:flex-row gap-4 items-end">
                      <div className="flex-1 w-full">
                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1">N√∫mero</label>
                        <input
                          type="text"
                          value={newTicketNumber}
                          onChange={(e) => handleNumberInput(e.target.value, setNewTicketNumber)}
                          placeholder="00000"
                          className="w-full text-3xl font-mono tracking-widest text-center border-2 border-gray-200 rounded-lg p-2 focus:border-emerald-500 outline-none placeholder-gray-200 transition-colors"
                          maxLength={5}
                        />
                      </div>
                      <div className="w-full md:w-24">
                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Euros</label>
                        <input
                          type="number"
                          value={newTicketAmount}
                          onChange={(e) => setNewTicketAmount(e.target.value)}
                          placeholder="20"
                          className="w-full border-gray-200 rounded-lg p-3 outline-none focus:border-emerald-500 border"
                        />
                      </div>
                      <div className="w-full md:w-1/3">
                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Nota</label>
                        <input
                          type="text"
                          value={newTicketNote}
                          onChange={(e) => setNewTicketNote(e.target.value)}
                          placeholder="Ej: Del bar..."
                          className="w-full border-gray-200 rounded-lg p-3 outline-none focus:border-emerald-500 border"
                        />
                      </div>
                      <button 
                        type="submit"
                        disabled={newTicketNumber.length < 5}
                        className="w-full md:w-auto bg-emerald-600 hover:bg-emerald-700 disabled:opacity-50 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all flex items-center justify-center gap-2"
                      >
                        <Icons.Plus size={20} /> Guardar
                      </button>
                    </form>
                  </div>
                </section>

                {/* 2. Comprobar */}
                <section className="bg-white rounded-xl shadow-xl border-2 border-yellow-400 relative overflow-hidden">
                  <div className="bg-red-700 p-3 flex items-center gap-2 text-white relative z-10">
                    <Icons.Gift className="text-yellow-300" size={20} />
                    <h2 className="font-bold text-sm uppercase">Comprobar Premio</h2>
                  </div>
                  
                  <div className="p-6 relative z-10">
                    <form onSubmit={checkWinningNumber} className="flex flex-col md:flex-row gap-4 items-center bg-red-50 p-4 rounded-lg border border-red-100">
                      <div className="text-center w-full">
                        <label className="block text-xs font-bold text-red-800 uppercase mb-1">N√∫mero Premiado</label>
                        <input
                          type="text"
                          value={checkNumber}
                          onChange={(e) => handleNumberInput(e.target.value, setCheckNumber)}
                          placeholder="00000"
                          className="w-full text-4xl font-mono font-bold tracking-widest text-center text-red-700 bg-white border-2 border-red-200 rounded-lg p-3 focus:border-yellow-500 outline-none shadow-inner"
                          maxLength={5}
                        />
                      </div>
                      
                      <div className="w-full md:w-auto flex flex-col gap-2">
                         <select 
                            value={prizeType}
                            onChange={(e) => setPrizeType(e.target.value)}
                            className="p-2 rounded border border-gray-300 text-sm bg-white font-medium"
                         >
                            <option value="gordo">El Gordo (400k)</option>
                            <option value="segundo">2¬∫ Premio (125k)</option>
                            <option value="tercero">3¬∫ Premio (50k)</option>
                            <option value="cuarto">4¬∫ Premio (20k)</option>
                            <option value="quinto">5¬∫ Premio (6k)</option>
                            <option value="pedrea">Pedrea (100‚Ç¨)</option>
                         </select>
                        <button 
                          type="submit"
                          disabled={checkNumber.length < 5}
                          className="bg-yellow-500 hover:bg-yellow-600 text-red-900 font-extrabold py-3 px-8 rounded-lg shadow-lg transform active:scale-95 transition-all flex items-center justify-center gap-2"
                        >
                          <Icons.Coins size={20} /> COMPROBAR
                        </button>
                      </div>
                    </form>

                     <div className="mt-4 text-center border-t border-gray-100 pt-3">
                       <button 
                         onClick={simulateDraw}
                         className="text-xs text-emerald-600 hover:text-emerald-800 font-bold flex items-center justify-center gap-1 mx-auto hover:bg-emerald-50 px-3 py-1 rounded transition-colors"
                       >
                         <Icons.Sparkles size={14} /> Modo Simulacro: Probar suerte (Demo)
                       </button>
                    </div>
                  </div>
                </section>

                {/* 3. Lista */}
                <section>
                  <div className="flex items-center justify-between mb-4 px-2">
                    <h3 className="text-lg font-bold text-emerald-900">
                       Tus D√©cimos Guardados
                    </h3>
                    {tickets.length > 0 && (
                        <span className="text-xs bg-white px-2 py-1 rounded border border-gray-200 text-gray-500">
                            {tickets.length} total
                        </span>
                    )}
                  </div>

                  {tickets.length === 0 ? (
                    <div className="text-center py-12 bg-white rounded-xl border-2 border-dashed border-gray-300 text-gray-400">
                      <div className="flex justify-center mb-2 opacity-50"><Icons.Ticket size={48}/></div>
                      <p>Lista vac√≠a.</p>
                      <p className="text-sm">Tus d√©cimos se guardar√°n aqu√≠.</p>
                    </div>
                  ) : (
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                      {tickets.map((ticket) => (
                        <div key={ticket.id} className="bg-white p-3 rounded-lg shadow-sm border-b-4 border-b-emerald-600 hover:translate-y-[-2px] transition-transform group">
                          <div className="flex justify-between items-start">
                            <div>
                              <span className="text-2xl font-mono font-bold text-gray-800 tracking-wider block">
                                {ticket.number}
                              </span>
                              <div className="flex items-center gap-2 mt-1">
                                 <span className="text-emerald-700 font-bold bg-emerald-50 px-1.5 rounded text-xs">{ticket.amount}‚Ç¨</span>
                                 {ticket.note && (
                                    <span className="text-gray-500 text-xs italic truncate max-w-[120px]">{ticket.note}</span>
                                 )}
                              </div>
                            </div>
                            <button 
                              onClick={() => removeTicket(ticket.id)}
                              className="text-gray-200 hover:text-red-500 transition-colors"
                              title="Borrar"
                            >
                              <Icons.Trash2 size={16} />
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </section>
              </main>

              <footer className="text-center text-gray-500 text-xs py-8">
                <p>Datos guardados en este navegador.</p>
                
                {/* BOTONES DE EXPORTAR E IMPORTAR */}
                <div className="flex justify-center gap-6 mt-4">
                    <button onClick={handleExport} className="flex items-center gap-1.5 text-emerald-700 hover:text-emerald-900 font-semibold bg-emerald-100/50 hover:bg-emerald-100 px-3 py-1.5 rounded transition-colors">
                        <Icons.Download size={14} /> Exportar
                    </button>
                    <button onClick={handleImport} className="flex items-center gap-1.5 text-emerald-700 hover:text-emerald-900 font-semibold bg-emerald-100/50 hover:bg-emerald-100 px-3 py-1.5 rounded transition-colors">
                        <Icons.Upload size={14} /> Importar
                    </button>
                </div>
              </footer>

              {/* Modal */}
              {isModalOpen && lastResult && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                  <div className="bg-white rounded-2xl shadow-2xl max-w-sm w-full overflow-hidden">
                    
                    <div className={`p-6 text-center ${lastResult.hasPrize ? 'bg-gradient-to-b from-yellow-300 to-yellow-500' : 'bg-gray-100'} relative`}>
                      <button onClick={() => setIsModalOpen(false)} className="absolute top-3 right-3 p-1 rounded-full bg-black/10 hover:bg-black/20 transition-colors">
                        <Icons.X size={18} />
                      </button>

                      {lastResult.hasPrize ? (
                        <>
                          <div className="text-5xl mb-2 animate-bounce">üéâ</div>
                          <h2 className="text-2xl font-black text-red-900 uppercase tracking-wide">
                            ¬°PREMIO!
                          </h2>
                          <p className="text-red-900 font-medium text-sm mt-1">N√∫mero: {lastResult.checkedNumber}</p>
                           {lastResult.totalWon > 0 && (
                             <div className="mt-3 bg-white/80 rounded p-2 inline-block shadow-sm backdrop-blur">
                                <span className="text-xs font-bold block text-red-800 uppercase">Ganancia Total</span>
                                <span className="text-2xl font-mono font-bold text-black">{formatMoney(lastResult.totalWon)}</span>
                             </div>
                           )}
                        </>
                      ) : (
                        <>
                          <div className="text-4xl mb-2">üçÄ</div>
                          <h2 className="text-xl font-bold text-gray-700">Sin suerte</h2>
                          <p className="text-gray-500 text-sm mt-1">No coincide con el {lastResult.checkedNumber}</p>
                        </>
                      )}
                    </div>

                    <div className="p-5 space-y-4 max-h-[50vh] overflow-y-auto">
                      
                      {lastResult.exact.length > 0 && (
                        <div className="bg-green-50 border border-green-200 rounded-lg p-3">
                          <h4 className="font-bold text-green-800 text-sm flex items-center gap-2 mb-2">
                            <Icons.CheckCircle2 size={16} /> Premio Exacto
                          </h4>
                          <ul className="space-y-2">
                            {lastResult.exact.map(t => (
                              <li key={t.id} className="flex justify-between items-center bg-white p-2 rounded border border-green-100">
                                <span className="font-mono font-bold text-lg">{t.number}</span>
                                <span className="font-bold text-green-600 text-sm">{formatMoney(t.prizeAmount)}</span>
                              </li>
                            ))}
                          </ul>
                        </div>
                      )}

                      {lastResult.terminations.length > 0 && (
                        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                          <h4 className="font-bold text-yellow-800 text-sm flex items-center gap-2 mb-1">
                            <Icons.RefreshCw size={16} /> Terminaci√≥n (..{lastResult.checkedNumber.slice(-2)})
                          </h4>
                          <p className="text-[10px] text-yellow-700 mb-2">Posible premio menor (reintegro, etc).</p>
                          <ul className="space-y-1">
                            {lastResult.terminations.map(t => (
                              <li key={t.id} className="flex justify-between px-2 py-1 text-sm text-gray-600 border-b border-yellow-100 last:border-0">
                                <span className="font-mono">{t.number}</span>
                                <span className="text-xs italic">Coincide final</span>
                              </li>
                            ))}
                          </ul>
                        </div>
                      )}

                      <button 
                        onClick={() => setIsModalOpen(false)}
                        className="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 rounded-lg transition-colors"
                      >
                        Cerrar
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
